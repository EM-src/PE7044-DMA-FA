SET VERIFY ON

SET ECHO ON

CREATE TYPE CUSTOMER_TYPE_NEST AS OBJECT (
  CUSTOMER_ID         NUMBER(3),
  FULL_NAME           VARCHAR(50),
  ADDRESS             VARCHAR(50),
  DOB                 DATE,
  GENDER              CHAR(1),
  CONTACT_DETAILS     CHAR(13)
)
/

CREATE TYPE CUSTOMER_NEST_TYPE AS TABLE OF CUSTOMER_TYPE_NEST
/

CREATE TABLE AGENTS_AND_CUSTS (
  AGENT_ID            NUMBER(3),
  CUSTOMER_DETAILS    CUSTOMER_NEST_TYPE,
  HEADQUARTER         VARCHAR(25),
  FULL_NAME           VARCHAR(50),
  ADDRESS             VARCHAR(100),
  WEBSITE             VARCHAR(50),
  CONTACT_DETAILS     CHAR(13)
)
NESTED TABLE CUSTOMER_DETAILS STORE AS CUST_DETS
/

INSERT INTO AGENTS_AND_CUSTS VALUES (10, CUSTOMER_NEST_TYPE(CUSTOMER_TYPE_NEST(200,'BRENNAN LAWSON','SPRINGFIELD RD 97, TAUNTON','16-JUN-1988','M','+441234567825'),
                                      CUSTOMER_TYPE_NEST(205,'NEAL MCGEE','SEAVIEW RD 9, NEWRY','01-AUG-1976','M','+441234567830')),
                                      'NEWCASTLE','NEWCASTLE REAL ESTATE','GIBSON ST, 1','WWW.NCRE.CO.UK','+441234567890');
INSERT INTO AGENTS_AND_CUSTS VALUES (12, CUSTOMER_NEST_TYPE(CUSTOMER_TYPE_NEST(201,'KAISHA MILNE','MANCHESTER RD 53, LLANDRINDOD WELLS','28-SEP-1978','F','+441234567826'),
                                      CUSTOMER_TYPE_NEST(209,'ANNA WEBSTER','LIVERPOOL AVE 115, LIVERPOOL','09-AUG-1976','F','+441234567834')),
                                      'LONDON','LONDON REAL ESTATE','GOSSET ST, 3','WWW.LRE.CO.UK','+441234567892');
INSERT INTO AGENTS_AND_CUSTS VALUES (13, CUSTOMER_NEST_TYPE(CUSTOMER_TYPE_NEST(204,'RENAE BELTRAN','MERRION STRAND 88, DUBLIN','09-JUL-2002','F','+441234567829'),
                                      CUSTOMER_TYPE_NEST(206,'LIAM PATERSON','NEW ROAD 34, BELFAST','30-OCT-1994','M','+441234567831'),
                                      CUSTOMER_TYPE_NEST(207,'ANNA WEBSTER','LONDON RD 115, LONDON','09-DEC-1999','F','+441234567832')),
                                      'EDINBURGH','EDINBURGH REAL ESTATE','PRINCESS ST, 4','WWW.EDRE.CO.UK','+441234567893');
INSERT INTO AGENTS_AND_CUSTS VALUES (14, CUSTOMER_NEST_TYPE(CUSTOMER_TYPE_NEST(208,'THOMAS MILLER','BLUEBERRY RD 115, MANCHESTER','09-DEC-1980','M','+441234567833')),
                                      'WOKING','WOKING REAL ESTATE','GUILDFORD ST, 5','WWW.WRE.CO.UK','+441234567894');
INSERT INTO AGENTS_AND_CUSTS VALUES (16, CUSTOMER_NEST_TYPE(CUSTOMER_TYPE_NEST(203,'TOMMIE DRISCOLL','ALMOND VILLAS 13, WOKING','23-JUN-1965','M','+441234567828')),
                                      'NEWCASTLE','BEST NEWCASTLE REAL ESTATE','NEWTON ST, 13','WWW.BNCRE.CO.UK','+441234567896');

/*
  DISPLAY DETAILS OF ALL CUSTOMERS REGISTERED IN AGENTS WITH FULL NAME 'NEWCASTLE REAL ESTATE'
  AND 'EDINBURGH REAL ESTATE' THAT ARE BORN BETWEEN 1988 AND 1999.
*/

SELECT AC.AGENT_ID, AC.FULL_NAME, CD.CUSTOMER_ID, CD.FULL_NAME AS "CUST_FN", CD.DOB, CD.CONTACT_DETAILS AS "CUST_CD"
FROM AGENTS_AND_CUSTS AC, TABLE(AC.CUSTOMER_DETAILS) CD
WHERE AC.FULL_NAME IN ('NEWCASTLE REAL ESTATE', 'EDINBURGH REAL ESTATE')
AND CD.DOB BETWEEN '01-JAN-1988' AND '31-DEC-1999'
/
